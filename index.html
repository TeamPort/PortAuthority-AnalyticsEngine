<html>
<script src="run.js"></script>
<script src="marcher-energy.js"></script>
<script src="tx2-energy.js"></script>
<script src="authority.js"></script>
<script src="instance.js"></script>
<script src="x86.words.js"></script>
<script src="arm64.words.js"></script>
<script src="synthetic.js"></script>

<script src="pako.min.js"></script>

<input type="file" id="replay" multiple>
<script>
    function updateText()
    {
        var name = document.getElementById("algorithm")

        var selected = document.getElementById("selection").selectedIndex
        name.innerHTML=names[selected]
        switch(selected)
        {
        }
    }

    var names = [
        "O(1)",
        "O(log log n)",
        "O(log n)",
        "O((log n)<sup>c</sup>)",
        "O(n<sup>1/c</sup>)",
        "O(n)",
        "O(n log* n)",
        "O(n log n)",
        "O(n<sup>2</sup>)",
        "O(n<sup>c</sup>)",
        "O(c<sup>n</sup>)",
        "O(n!)"
    ]

    replay.addEventListener('change', function(event)
    {
          var i = 0;
          while(i < replay.files.length)
          {
              var file = replay.files[i];
              if(!file)
              {
                  continue;
              }

              var reader = new FileReader();
              reader.onloadend = function(event)
              {
                  if(event.target.readyState == FileReader.DONE)
                  {
                      console.log("Unpacking... " + event.target.fileName)
                      var result = window.pako.inflate(event.target.result);
                      var text = new TextDecoder("utf-8").decode(result)
                      run = JSON.parse(text);
                      if(analyzers == null)
                      {
                          analyzers = [new Coverage(run.size), new Category(), new Energy(run.triple)]
                      }
                      analyze(run);
                  }
              };
              reader.fileName = file.name
              reader.readAsArrayBuffer(file.slice(0, file.size));
              i++;
          }
    }, false);
</script>
<br>
<button onclick="instance()">Build Instance Table</button>
<script>
function instance()
{
    buildInstanceMap(run)

    var text = ""
    var total = 0
    var keys = instrMap.keys()
    for(var i = 0; i < instrMap.size; i++)
    {
        var key = keys.next()
        var count = instrMap.get(key.value)
        text += key.value + " " + count + "\n"
        total+=count
    }
    document.getElementById("output").value = text + total + "\n"
}
</script>
<br>
<button onclick="synthetic()">Build Synthetic Table</button>
<script>
    function synthetic()
    {
        buildSyntheticInstanceMap(run)

        var text = ""
        var total = 0
        var keys = synthMap.keys()
        for(var i = 0; i < synthMap.size; i++)
        {
            var key = keys.next()
            var count = synthMap.get(key.value)
            text += key.value + " " + count + "\n"
            total+=count
        }
        document.getElementById("output").value = text + total + "\n"
    }
</script>
<br>
<textarea id="output" style="width: 512px; height: 512px"></textarea>
<br>
<p id="algorithm">O(1)</p>
<select id="selection" onchange="updateText()">
    <option>Constant</option>
    <option>Double Logarithmic</option>
    <option>Logarithmic</option>
    <option>Polylogarithmic</option>
    <option>Fractional Power</option>
    <option>Linear</option>
    <option>N Log-Star N</option>
    <option>Linearithmic</option>
    <option>Quadratic</option>
    <option>Polynomial</option>
    <option>Exponential</option>
    <option>Factorial</option>
</select>
<script>
    if(run != null)
    {
        analyze(run);
        document.getElementById("replay").style.display = "none"

    }
</script>
</html>
