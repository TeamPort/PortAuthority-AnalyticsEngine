<html>
<style>
  html
  {
    background:#1e1e1e
  }
  body
  {
    margin: 0px
  }
  .menubar
  {
    background:#3e3e39
  }
  .toolbar
  {
    background:#303030
  }
</style>
<script src="run.js"></script>
<script src="marcher-energy.js"></script>
<script src="tx2-energy.js"></script>
<script src="instance.js"></script>
<script src="bigrams.js"></script>
<script src="trigrams.js"></script>
<script src="synthetic.js"></script>
<script src="authority.js"></script>

<script src="pako.min.js"></script>

<div class="menubar" style="width: 100%; height: 20px;">
</div>
<div>
<div class="toolbar" style="float: left; width: 44px; height: 100%;">
<a href="sample.zip" title="Download sample" >
    <img src="download.png"/>
</a>
<img src="files.png" onclick="forward()"/>
</div>
<div style="margin-left: 64px;">
<input type="file" id="replay" style="display:none" multiple>
<script>
    function forward()
    {
        document.getElementById("replay").click();
    }

    function factorial(value)
    {
        if (value < 0)
        {
            return -1;
        }
        else if (value == 0)
        {
            return 1;
        }
        else
        {
            return (value * factorial(value-1));
        }
    }

    function updateOutput()
    {
        var scale = 1;
        var selected = document.getElementById("selection").selectedIndex
        var n = document.getElementById("BigO").value
        var c = document.getElementById("Constant").value
        switch(selected)
        {
            case 0: // Constant
                break;
            case 1: // Double Logarithmic
                scale=Math.log10(Math.log10(n))
                break;
            case 2: // Logarithmic
                var factor = Math.log10(n)
                scale=factor
                break;
            case 3: // Polylogarithmic
                scale=Math.pow(Math.log10(n), c)
                break;
            case 4: // Fractional Power
                scale=Math.pow(n,1/c)
                break;
            case 5: // Linear
                scale=n
                break;
            case 6: // N Log-Star N
                break;
            case 7: // Linearithmic
                scale=(n*Math.log10(n))
                break;
            case 8: // Quadratic
                scale=Math.pow(n,2)
                break;
            case 9: // Polynomial
                scale=Math.pow(n,c)
                break;
            case 10: // Exponential
                scale=Math.pow(c,n)
                break;
            case 11: // Factorial
                scale=factorial(n)
                break;
        }

        {
            var energy = analyzers[2].energyUsage()
            document.getElementById("output").value = "Host Platform:\n"
            document.getElementById("output").value += "Coverage " + analyzers[0].percentCoverage() + "%\n"
            document.getElementById("output").value += "Energy Usage (J) " +  energy*scale + "\n"
        }

        {
            var energy = predicted[0].energyUsage()
            var memory = predicted[1];
            document.getElementById("output").value += "\nTarget Platform:\n"
            document.getElementById("output").value += "Energy Usage (J) " +  energy*scale + "\n"
            document.getElementById("output").value += "Stored bytes " + memory.stores()*scale + "\n"
            document.getElementById("output").value += "Loaded bytes " + memory.accesses()*scale + "\n"
        }
    }

    function updateText()
    {
        var name = document.getElementById("algorithm")

        var selected = document.getElementById("selection").selectedIndex
        name.innerHTML=names[selected]
        updateOutput();
    }

    var names = [
        "O(1)",
        "O(log log n)",
        "O(log n)",
        "O((log n)<sup>c</sup>)",
        "O(n<sup>1/c</sup>)",
        "O(n)",
        "O(n log* n)",
        "O(n log n)",
        "O(n<sup>2</sup>)",
        "O(n<sup>c</sup>)",
        "O(c<sup>n</sup>)",
        "O(n!)"
    ]

    replay.addEventListener('click', function(event)
    {
        analyzers = null
        predicted = null
    }, false)

    replay.addEventListener('change', function(event)
    {
          var i = 0;
          while(i < replay.files.length)
          {
              var file = replay.files[i];
              if(!file)
              {
                  continue;
              }

              var reader = new FileReader();
              reader.onloadend = function(event)
              {
                  if(event.target.readyState == FileReader.DONE)
                  {
                      console.log("Unpacking... " + event.target.fileName)
                      var result = window.pako.inflate(event.target.result);
                      var text = new TextDecoder("utf-8").decode(result)
                      run = JSON.parse(text);
                      if(analyzers == null)
                      {
                          analyzers = [new Coverage(run.size), new Category(), new Energy(run.triple)]
                      }
                      if(predicted == null)
                      {
                           predicted = [new Energy("aarch64"), new AArch64Memory()]
                      }
                      analyze(run);
                      updateOutput();
                  }
              };
              reader.fileName = file.name
              reader.readAsArrayBuffer(file.slice(0, file.size));
              i++;
          }
    }, false);
</script>
<br>
<textarea id="output" style="width: 512px; height: 256px; border: none; color: white; background:#1e1e1e">Ready!</textarea>
<br>
<table style="width: 512px;">
<tr>
<td><p id="algorithm">O(1)</p></td>
<td><p>n</p></td>
<td><p>c</p></td>
</tr>
<tr>
<td>
    <select id="selection" onchange="updateText()">
        <option>Constant</option>
        <option>Double Logarithmic</option>
        <option>Logarithmic</option>
        <option>Polylogarithmic</option>
        <option>Fractional Power</option>
        <option>Linear</option>
        <option>N Log-Star N</option>
        <option>Linearithmic</option>
        <option>Quadratic</option>
        <option>Polynomial</option>
        <option>Exponential</option>
        <option>Factorial</option>
    </select>
</td>
<td>
    <input type="number" id="BigO" min="1" value="1">
</td>
<td>
    <input type="number" id="Constant" min="1" value="1">
</td>
<td>
    <input type="button" onclick="updateText()">
</td>
</tr>
</table>
<script>
    if(run != null)
    {
        analyze(run);
        document.getElementById("replay").style.display = "none"
    }
</script>
</div>
<br>
<!--button onclick="instance()">Build Instance Table</button>
<button onclick="synthetic(2)">Build Synthetic 2-Gram Table</button>
<button onclick="synthetic(3)">Build Synthetic 3-Gram Table</button-->
<script>
    function instance()
    {
        buildInstanceMap(run)

        var text = ""
        var total = 0
        var keys = instrMap.keys()
        for(var i = 0; i < instrMap.size; i++)
        {
            var key = keys.next()
            var count = instrMap.get(key.value)
            text += key.value + " " + count + "\n"
            total+=count
        }
//        document.getElementById("output").value = text + total + "\n"
    }

    function synthetic(n)
    {
        buildSyntheticInstanceMap(run, n)

        var text = ""
        var total = 0
        var keys = synthMap.keys()
        for(var i = 0; i < synthMap.size; i++)
        {
            var key = keys.next()
            var count = synthMap.get(key.value)
            text += key.value + " " + count + "\n"
            total+=count
        }
//        document.getElementById("output").value = text + total + "\n"
    }
</script>
</html>
