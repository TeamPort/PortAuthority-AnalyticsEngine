<html>
<script src="run.js"></script>
<script src="marcher-energy.js"></script>
<script src="tx2-energy.js"></script>
<script src="authority.js"></script>
<script src="instance.js"></script>
<script src="x86.words.js"></script>
<script src="arm64.words.js"></script>
<script src="synthetic.js"></script>

<script src="pako.min.js"></script>

<input type="file" id="replay">
<script>
    replay.addEventListener('change', function(event)
    {
      var file = replay.files[0];
      if(!file)
      {
        return;
      }
      var reader = new FileReader();
      reader.onloadend = function(event)
      {
        if(event.target.readyState == FileReader.DONE)
        {
            var result = window.pako.inflate(event.target.result);
            var text = new TextDecoder("utf-8").decode(result)
            run = JSON.parse(text);
            analyze(run);
        }
      };
      reader.readAsArrayBuffer(file.slice(0, file.size));
    }, false);
</script>
<br>
<button onclick="instance()">Build Instance Table</button>
<script>
function instance()
{
    buildInstanceMap(run)

    var text = ""
    var total = 0
    var keys = instrMap.keys()
    for(var i = 0; i < instrMap.size; i++)
    {
        var key = keys.next()
        var count = instrMap.get(key.value)
        text += key.value + " " + count + "\n"
        total+=count
    }
    document.getElementById("output").value = text + total + "\n"
}
</script>
<br>
<button onclick="synthetic()">Build Synthetic Table</button>
<script>
    function synthetic()
    {
        buildSyntheticInstanceMap(run)

        var text = ""
        var total = 0
        var keys = synthMap.keys()
        for(var i = 0; i < synthMap.size; i++)
        {
            var key = keys.next()
            var count = synthMap.get(key.value)
            text += key.value + " " + count + "\n"
            total+=count
        }
        document.getElementById("output").value = text + total + "\n"
    }
</script>
<br>
<textarea id="output" style="width: 512px; height: 512px"></textarea>
<script>
    if(run != null)
    {
        analyze(run);
        document.getElementById("replay").style.display = "none"

    }
</script>
</html>
